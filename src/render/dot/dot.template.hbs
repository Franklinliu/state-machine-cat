digraph "state transitions" {
  {{{graphAttributes}}}
  node [shape=plaintext style=filled fillcolor=white fontname=Helvetica fontsize=12 penwidth=2.0]
  edge [fontname=Helvetica fontsize=10]

  {{> dot.states.template.hbs}}

  {{#transitions}}
  {{^noteName}}
    {{^isCompositeSelf}}
    "{{{from}}}" -> "{{{to}}}" [label="{{^label}} {{/label}}{{{label}}}"
                            {{~#fromComposite}} ltail="cluster_{{{from}}}"{{/fromComposite}}
                            {{~#toComposite}} lhead="cluster_{{{to}}}"{{/toComposite}}
                            {{~#color}} color="{{{.}}}" fontcolor="{{{.}}}"{{/color}}]
    {{/isCompositeSelf}}
    {{#isCompositeSelf}}
      "{{{from}}}" -> "self_{{{from}}}" [label="{{^label}} {{/label}}{{{label}}}" arrowhead=none 
                            {{~#tailportflags}} {{{.}}}{{/tailportflags}} ltail="cluster_{{{from}}}"
                            {{~#color}} color="{{{.}}}" fontcolor="{{{.}}}"{{/color}}]
      "self_{{{from}}}" -> "{{{from}}}" [lhead="cluster_{{{from}}}" 
                            {{~#headportflags}} {{{.}}}{{/headportflags}}
                            {{~#color}} color="{{{.}}}"{{/color}}]
    {{/isCompositeSelf}}
  {{/noteName}}
  {{#noteName}}
      "i_{{{.}}}" [shape=point style=invis margin=0 width=0 height=0 fixedsize=true]
      "{{{../from}}}" -> "i_{{{.}}}" [arrowhead=none
                                {{~#../fromComposite}} ltail="cluster_{{{../from}}}"{{/../fromComposite}}]
      "i_{{{.}}}" -> "{{{../to}}}" [label="{{^../label}} {{/../label}}{{{../label}}}"
                                {{~#../toComposite}} lhead="cluster_{{{../to}}}"{{/../toComposite}}]
      "i_{{{.}}}" -> "{{{.}}}" [style=dashed arrowtail=none arrowhead=none weight=0]
      "{{{.}}}" [label="{{{../noteFlattened}}}" shape=note fontsize=10 fillcolor="#ffffcc" penwidth=1.0]
  {{/noteName}}
  {{/transitions}}
}
